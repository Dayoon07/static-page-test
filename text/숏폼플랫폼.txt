-- 사용자 테이블
CREATE TABLE SHORTFORM_USERS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    USERNAME VARCHAR2(200) NOT NULL UNIQUE,
    MAIL VARCHAR2(200) NOT NULL UNIQUE,
    PASSWORD VARCHAR2(200) NOT NULL,
    PROFILE_IMG VARCHAR2(500) NOT NULL,      -- 프로필 파일 이미지 이름
    PROFILE_IMG_SRC VARCHAR2(500) NOT NULL,  -- 프로필 파일 이미지 경로
    BIO CLOB,   -- 자기소개말
    MENTION VARCHAR2(300) NOT NULL UNIQUE,
    IS_SOCIAL NUMBER(1) DEFAULT 0 NOT NULL,
    PROVIDER  VARCHAR2(50) DEFAULT 'LOCAL' NOT NULL,
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 팔로우 관계 테이블
CREATE TABLE SHORTFORM_USERS_FOLLOWS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    FOLLOW_USER_ID NUMBER NOT NULL,     -- 팔로우한(요청한) 유저의 ID
    FOLLOWED_USER_ID NUMBER NOT NULL,   -- 팔로우된(상대방) 유저의 ID
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_FOLLOW_USER FOREIGN KEY (FOLLOW_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_FOLLOWED_USER FOREIGN KEY (FOLLOWED_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_FOLLOW UNIQUE (FOLLOW_USER_ID, FOLLOWED_USER_ID),             -- 2개의 필드를 묶어서 하나의 필드로 보는 거임
    CONSTRAINT CK_NOT_SELF_FOLLOW CHECK (FOLLOW_USER_ID != FOLLOWED_USER_ID)    -- 자기 자신을 팔로우 못함
);

-- 비디오 테이블
CREATE TABLE SHORTFORM_VIDEOS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    VIDEO_TITLE VARCHAR2(200) NOT NULL,
    VIDEO_DESCRIPTION CLOB,                     -- 설명란
    VIDEO_NAME VARCHAR2(1000) NOT NULL,
    VIDEO_SRC VARCHAR2(1000) NOT NULL,          -- 영상 경로
    VIDEO_TAG VARCHAR2(500),                    -- 해시태크
    VIDEO_VIEWS NUMBER DEFAULT 0,               -- 조회수
    VIDEO_LOC VARCHAR2(500) NOT NULL UNIQUE,    -- 영상 uuid
    UPLOADER_USER_ID NUMBER NOT NULL,           -- 업로드한 유저의 아이디
    VIDEO_WATCH_AVAILABILITY VARCHAR2(50) NOT NULL CHECK (VIDEO_WATCH_AVAILABILITY IN ('PUBLIC', 'FOLLOWERS', 'PRIVATE')),
    COMMENT_AVAILABILITY VARCHAR2(50) NOT NULL CHECK (COMMENT_AVAILABILITY IN ('PUBLIC', 'FOLLOWERS', 'PRIVATE')),
    PREVIEW_IMG VARCHAR2(1000) NOT NULL,
    UPLOAD_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_UPLOADER FOREIGN KEY (UPLOADER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE
);

-- 좋아요 테이블
CREATE TABLE SHORTFORM_VIDEO_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    LIKE_VIDEO_ID NUMBER NOT NULL,  -- 좋아요를 누른 영상의 아이디
    LIKER_USER_ID NUMBER NOT NULL,  -- 좋아요를 누른 유저의 아이디
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_LIKE_VIDEO FOREIGN KEY (LIKE_VIDEO_ID) REFERENCES SHORTFORM_VIDEOS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_LIKER_USER FOREIGN KEY (LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_VIDEO_LIKE UNIQUE (LIKE_VIDEO_ID, LIKER_USER_ID)
);

-- 댓글 테이블
CREATE TABLE SHORTFORM_COMMENTS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMENT_TEXT CLOB NOT NULL,
    COMMENT_USER_ID NUMBER NOT NULL,    -- 댓글을 작성한 유저의 아이디
    COMMENT_VIDEO_ID NUMBER NOT NULL,   -- 댓글을 작성한 영상의 아이디
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_COMMENT_USER FOREIGN KEY (COMMENT_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMENT_VIDEO FOREIGN KEY (COMMENT_VIDEO_ID) REFERENCES SHORTFORM_VIDEOS(ID) ON DELETE CASCADE
);

-- 댓글 좋아요 테이블
CREATE TABLE SHORTFORM_COMMENT_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMENT_ID NUMBER NOT NULL, -- 댓글의 아이디
    LIKER_USER_ID NUMBER NOT NULL,  -- 댓글에 좋아요를 누른 유저의 아이디
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_COMMENT_LIKE_COMMENT FOREIGN KEY (COMMENT_ID) REFERENCES SHORTFORM_COMMENTS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMENT_LIKE_USER FOREIGN KEY (LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_COMMENT_LIKE UNIQUE (COMMENT_ID, LIKER_USER_ID)
);

-- 대댓글 테이블
CREATE TABLE SHORTFORM_COMMENT_REPLYS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMENT_REPLY_TEXT CLOB NOT NULL,   -- 대댓글
    COMMENT_REPLY_USER_ID NUMBER NOT NULL,  -- 대댓글을 작성한 유저의 아이디
    COMMENT_REPLY_ID NUMBER NOT NULL,  -- 대댓글을 작성할 댓글의 아이디
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_REPLY_USER FOREIGN KEY (COMMENT_REPLY_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_REPLY_COMMENT FOREIGN KEY (COMMENT_REPLY_ID) REFERENCES SHORTFORM_COMMENTS(ID) ON DELETE CASCADE
);

-- 대댓글 좋아요 테이블
CREATE TABLE SHORTFORM_REPLY_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    REPLY_ID NUMBER NOT NULL,   -- 대댓글 아이디
    LIKER_USER_ID NUMBER NOT NULL,  -- 좋아요를 누른 유저의 아이디
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_REPLY_LIKE_REPLY FOREIGN KEY (REPLY_ID) REFERENCES SHORTFORM_COMMENT_REPLYS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_REPLY_LIKE_USER FOREIGN KEY (LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_REPLY_LIKE UNIQUE (REPLY_ID, LIKER_USER_ID)
);

-- 검색 기록 테이블
CREATE TABLE SHORTFORM_SEARCH_LISTS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    SEARCHED_USER_ID NUMBER,    -- 검색한 유저의 아이디 (비로그인 시 검색어만 삽입)
    SEARCHED_WORD VARCHAR2(500) NOT NULL,    -- 검색어
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_SEARCHED_USER_ID FOREIGN KEY (SEARCHED_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE SET NULL
);

-- 시청 기록 테이블
CREATE TABLE SHORTFORM_VIEWSTORYS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    WATCHED_VIDEO_ID NUMBER NOT NULL,   -- 시청한 영상의 아이디
    WATCHED_USER_ID NUMBER NOT NULL,    -- 시청한 유저의 아이디 (비로그인 시 시청 기록은 아예 삽입 안함)
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_WATCHED_VIDEO FOREIGN KEY (WATCHED_VIDEO_ID) REFERENCES SHORTFORM_VIDEOS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_WATCHED_USER FOREIGN KEY (WATCHED_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE
);

-- 커뮤니티 테이블 (커뮤니티 글 내용, 작성자 PK, 공개 & 비공개 여부)
CREATE TABLE SHORTFORM_COMMUNITYS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMUNITY_TEXT CLOB, -- 커뮤니티 글 내용
    COMMUNITY_WRITER_ID NUMBER NOT NULL,    -- 커뮤니티 작성자 PK
    COMMUNITY_UUID VARCHAR2(50) NOT NULL UNIQUE,    -- 커뮤니티 UUID
    COMMUNITY_AVAILABILITY VARCHAR2(50) NOT NULL CHECK (COMMUNITY_AVAILABILITY IN ('PUBLIC', 'FOLLOWERS', 'PRIVATE')),
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_COMMUNITY_WRITER FOREIGN KEY (COMMUNITY_WRITER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE
);

-- 커뮤니티의 글과 같이 올라오는 이미지 또는 비디오 테이블
CREATE TABLE SHORTFORM_COMMUNITY_ADDITIONS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    FILE_SRC VARCHAR2(500) NOT NULL,
    COMMUNITY_ID NUMBER NOT NULL,   -- 커뮤니티 PK
    UPLOAD_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_ADDITION_COMMUNITY FOREIGN KEY (COMMUNITY_ID) REFERENCES SHORTFORM_COMMUNITYS(ID) ON DELETE CASCADE
);

-- 커뮤니티 좋아요 테이블
CREATE TABLE SHORTFORM_COMMUNITY_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMUNITY_ID NUMBER NOT NULL, -- 커뮤니티의 아이디
    LIKER_USER_ID NUMBER NOT NULL,  -- 커뮤니티에 좋아요를 누른 유저의 아이디
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_COMMUNITY_LIKE_COMMUNITY FOREIGN KEY (COMMUNITY_ID) REFERENCES SHORTFORM_COMMUNITYS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_LIKE_USER FOREIGN KEY (LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_COMMUNITY_LIKE UNIQUE (COMMUNITY_ID, LIKER_USER_ID)
);

-- 커뮤니티 댓글
CREATE TABLE SHORTFORM_COMMUNITY_COMMENTS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    COMMENT_TEXT CLOB NOT NULL,    -- 댓글 내용
    COMMENT_USER_ID NUMBER NOT NULL,    -- 댓글을 작성한 유저
    COMMUNITY_ID NUMBER NOT NULL,       -- 댓글을 작성한 커뮤니티 PK
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_COMMUNITY_COMMENT_USER FOREIGN KEY(COMMENT_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_COMMENT_COMMUNITY FOREIGN KEY(COMMUNITY_ID) REFERENCES SHORTFORM_COMMUNITYS(ID) ON DELETE CASCADE
);

-- 커뮤니티 댓글의 좋아요
CREATE TABLE SHORTFORM_COMMUNITY_COMMENT_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    LIKER_USER_ID NUMBER NOT NULL,  -- 좋아요를 누른 유저의 PK
    COMMENT_ID NUMBER NOT NULL,     -- 좋아요를 누른 댓글 PK
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_COMMUNITY_COMMENT_LIKE_USER FOREIGN KEY(LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_COMMENT_LIKE_COMMENT FOREIGN KEY(COMMENT_ID) REFERENCES SHORTFORM_COMMUNITY_COMMENTS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_COMMUNITY_COMMENT_LIKE UNIQUE (COMMENT_ID, LIKER_USER_ID)
);

-- 커뮤니티 대댓글 테이블 (기존 비디오 대댓글과 동일한 구조로 추가)
CREATE TABLE SHORTFORM_COMMUNITY_COMMENT_REPLYS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    REPLY_TEXT CLOB NOT NULL,   -- 대댓글 내용
    REPLY_USER_ID NUMBER NOT NULL,  -- 대댓글을 작성한 유저의 아이디
    COMMENT_ID NUMBER NOT NULL,  -- 대댓글을 작성할 댓글의 아이디
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETE_STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    CONSTRAINT FK_COMMUNITY_REPLY_USER FOREIGN KEY (REPLY_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_REPLY_COMMENT FOREIGN KEY (COMMENT_ID) REFERENCES SHORTFORM_COMMUNITY_COMMENTS(ID) ON DELETE CASCADE
);

-- 커뮤니티 대댓글 좋아요 테이블
CREATE TABLE SHORTFORM_COMMUNITY_COMMENT_REPLY_LIKES (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    REPLY_ID NUMBER NOT NULL,   -- 대댓글 아이디
    LIKER_USER_ID NUMBER NOT NULL,  -- 좋아요를 누른 유저의 아이디
    LIKE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_COMMUNITY_REPLY_LIKE_REPLY FOREIGN KEY (REPLY_ID) REFERENCES SHORTFORM_COMMUNITY_COMMENT_REPLYS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_REPLY_LIKE_USER FOREIGN KEY (LIKER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE CASCADE,
    CONSTRAINT UC_COMMUNITY_REPLY_LIKE UNIQUE (REPLY_ID, LIKER_USER_ID)
);

-- 신고 테이블
CREATE TABLE SHORTFORM_REPORTS (
    ID NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY,
    TARGET_TYPE VARCHAR2(100) NOT NULL,  -- (video, comment, community 등등 (reply도 같음))
    TARGET_ID NUMBER NOT NULL,  -- (신고 받은 target_type의 pk(id))
    REPORTER_USER_ID NUMBER,    -- 신고한 유저
    REPORTED_USER_ID NUMBER,    -- 신고 받은 콘텐츠를 제작한 유저
    REPORT_TYPE VARCHAR2(100) NOT NULL CHECK (REPORT_TYPE IN (
        'INAPPROPRIATE', 'SEXUAL', 'VIOLENCE', 'HATE_SPEECH', 'SPAM', 'COPYRIGHT',
        'FALSE_INFO', 'PRIVACY', 'ILLEGAL', 'ETC'
    )), -- 신고 구분
    REPORT_REASON VARCHAR2(1000),      -- 신고 사유 추가 (부가 설명)
    STATUS VARCHAR2(100) DEFAULT 'PENDING' NOT NULL CHECK (STATUS IN (
        'PENDING', 'REVIEWING', 'REJECTED', 'RESOLVED'
    )), -- 처리 구분
    ACTION_TAKEN VARCHAR2(100) DEFAULT 'NONE' CHECK (ACTION_TAKEN IN
        ('NONE', 'WARNING', 'CONTENT_HIDDEN', 'CONTENT_DELETED', 'USER_SUSPENDED', 'USER_BANNED'
    )), -- 처리 완료 후 취해진 조치

    REVIEW_COMMENT CLOB,    -- 조치 메세지
    REVIEWED_AT    TIMESTAMP,   -- 조치된 날짜
    CREATED_AT     TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,    -- 신고가 접수된 날짜
    UPDATED_AT     TIMESTAMP,   -- 수정한 날짜 (마지막으로 수정한 날짜)

    CONSTRAINT FK_REPORT_REPORTER FOREIGN KEY (REPORTER_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE SET NULL,
    CONSTRAINT FK_REPORT_REPORTED FOREIGN KEY (REPORTED_USER_ID) REFERENCES SHORTFORM_USERS(ID) ON DELETE SET NULL,
    CONSTRAINT UK_REPORT_UNIQUE UNIQUE (REPORTER_USER_ID, TARGET_TYPE, TARGET_ID)
);

-- 성능 향상을 위한 인덱스
CREATE INDEX IDX_VIDEOS_UPLOADER ON SHORTFORM_VIDEOS(UPLOADER_USER_ID);
CREATE INDEX IDX_VIDEOS_UPLOAD_AT ON SHORTFORM_VIDEOS(UPLOAD_AT);
CREATE INDEX IDX_COMMENTS_VIDEO ON SHORTFORM_COMMENTS(COMMENT_VIDEO_ID);
CREATE INDEX IDX_FOLLOWS_FOLLOWING ON SHORTFORM_USERS_FOLLOWS(FOLLOWED_USER_ID);
CREATE INDEX IDX_VIDEO_LIKES_VIDEO ON SHORTFORM_VIDEO_LIKES(LIKE_VIDEO_ID);
CREATE INDEX IDX_VIEWSTORYS_USER ON SHORTFORM_VIEWSTORYS(WATCHED_USER_ID);
CREATE INDEX IDX_VIEWSTORYS_VIDEO ON SHORTFORM_VIEWSTORYS(WATCHED_VIDEO_ID);

-- 성능 향상을 위한 커뮤니티 관련 인덱스
CREATE INDEX IDX_COMMUNITY_WRITER ON SHORTFORM_COMMUNITYS(COMMUNITY_WRITER_ID);
CREATE INDEX IDX_COMMUNITY_CREATE_AT ON SHORTFORM_COMMUNITYS(CREATE_AT);
CREATE INDEX IDX_COMMUNITY_AVAILABILITY ON SHORTFORM_COMMUNITYS(COMMUNITY_AVAILABILITY);
CREATE INDEX IDX_COMMUNITY_COMMENTS_COMMUNITY ON SHORTFORM_COMMUNITY_COMMENTS(COMMUNITY_ID);
CREATE INDEX IDX_COMMUNITY_COMMENTS_USER ON SHORTFORM_COMMUNITY_COMMENTS(COMMENT_USER_ID);
CREATE INDEX IDX_COMMUNITY_LIKES_COMMUNITY ON SHORTFORM_COMMUNITY_LIKES(COMMUNITY_ID);
CREATE INDEX IDX_COMMUNITY_LIKES_USER ON SHORTFORM_COMMUNITY_LIKES(LIKER_USER_ID);
CREATE INDEX IDX_COMMUNITY_ADDITIONS_COMMUNITY ON SHORTFORM_COMMUNITY_ADDITIONS(COMMUNITY_ID);

-- 신고 테이블 관련 인덱스
CREATE INDEX IDX_REPORTS_TARGET ON SHORTFORM_REPORTS(TARGET_TYPE, TARGET_ID);   -- 특정 영상이나 댓글에 달린 신고들을 한꺼번에 불러올 때
CREATE INDEX IDX_REPORTS_STATUS_CREATED ON SHORTFORM_REPORTS(STATUS, CREATED_AT);  -- "아직 처리 안 된 신고부터 보여줘"라고 할 때 성능을 결정
CREATE INDEX IDX_REPORTS_REPORTED_USER ON SHORTFORM_REPORTS(REPORTED_USER_ID);  -- "이 유저가 지금까지 몇 번 신고당했지?"를 조회할 때 필수



SELECT * FROM DBA_INDEXES WHERE INDEX_NAME LIKE '%' || 'IDX_' || '%' AND OWNER = 'SYSTEM';
SELECT * FROM USER_INDEXES WHERE INDEX_NAME LIKE '%IDX%';

SELECT * FROM SHORTFORM_USERS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_USERS_FOLLOWS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_VIDEOS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_VIDEO_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMENTS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMENT_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMENT_REPLYS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_REPLY_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_SEARCH_LISTS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_VIEWSTORYS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITYS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_ADDITIONS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_COMMENTS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_COMMENT_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_COMMENT_REPLYS ORDER BY ID DESC;
SELECT * FROM SHORTFORM_COMMUNITY_COMMENT_REPLY_LIKES ORDER BY ID DESC;
SELECT * FROM SHORTFORM_REPORTS ORDER ID DESC;

SELECT 
      (SELECT COUNT(*) FROM SHORTFORM_USERS)
    + (SELECT COUNT(*) FROM SHORTFORM_USERS_FOLLOWS) 
    + (SELECT COUNT(*) FROM SHORTFORM_VIDEOS) 
    + (SELECT COUNT(*) FROM SHORTFORM_VIDEO_LIKES) 
    + (SELECT COUNT(*) FROM SHORTFORM_COMMENTS) 
    + (SELECT COUNT(*) FROM SHORTFORM_COMMENT_LIKES) 
    + (SELECT COUNT(*) FROM SHORTFORM_COMMENT_REPLYS) 
    + (SELECT COUNT(*) FROM SHORTFORM_REPLY_LIKES) 
    + (SELECT COUNT(*) FROM SHORTFORM_SEARCH_LISTS) 
    + (SELECT COUNT(*) FROM SHORTFORM_VIEWSTORYS)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITYS)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_ADDITIONS)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_LIKES)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_COMMENTS)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_COMMENT_LIKES)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_COMMENT_REPLYS)
    + (SELECT COUNT(*) FROM SHORTFORM_COMMUNITY_COMMENT_REPLY_LIKES) 
    + (SELECT COUNT(*) FROM SHORTFORM_REPORTS) AS CNT 
FROM DUAL;

SELECT * FROM TAB;
PURGE RECYCLEBIN;

--DROP TABLE SHORTFORM_USERS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_USERS_FOLLOWS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_VIDEOS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_VIDEO_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMENTS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMENT_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMENT_REPLYS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_REPLY_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_SEARCH_LISTS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_VIEWSTORYS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITYS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_ADDITIONS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_COMMENTS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_COMMENT_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_COMMENT_REPLYS CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_COMMUNITY_COMMENT_REPLY_LIKES CASCADE CONSTRAINT;
--DROP TABLE SHORTFORM_REPORTS CASCADE CONSTRAINT;
