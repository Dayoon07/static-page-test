-- 사용자 테이블
CREATE TABLE MOVIE_USERS (
    user_id NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY, -- 사용자 고유 ID (자동 증가)
    phone VARCHAR2(20) UNIQUE NOT NULL,           -- 사용자 휴대폰 번호 (고유, 로그인 및 연락용)
    name VARCHAR2(100) NOT NULL,                  -- 사용자 이름
    email VARCHAR2(255) NOT NULL,                 -- 사용자 이메일 주소
    password VARCHAR2(255) NOT NULL,              -- 사용자 비밀번호 (암호화 저장 권장)
    create_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- 계정 생성 시각 (기본값 현재 시각)
);

-- 영화 테이블 (장르, 평점, 관람연령을 컬럼으로 통합)
CREATE TABLE MOVIE_MOVIES (
    movie_id NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY, -- 영화 ID
    title VARCHAR2(255) NOT NULL,         -- 영화 제목
    poster_image_url VARCHAR2(255),       -- 포스터 이미지
    genre VARCHAR2(50),                   -- 장르
    duration NUMBER                       -- 상영 시간(분)
);

-- 상영관 테이블 (좌석 정보 통합)
CREATE TABLE MOVIE_CINEMAS (
    cinema_id NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY, -- 상영관 고유 ID (자동 증가)
    cinema_name VARCHAR2(100) NOT NULL,        -- 상영관 이름
    total_seats NUMBER NOT NULL,                 -- 총 좌석 수
    cinema_type VARCHAR2(50),                   -- 상영관 유형 (예: 일반, IMAX, 4DX 등)
    seat_layout CLOB                             -- 좌석 배치 정보 (예: "A1-A20, B1-B20, C1-C20, ..."; JSON 또는 문자열)
);

-- 상영 시간표 테이블
CREATE TABLE MOVIE_SHOWTIMES (
    showtime_id NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY, -- 상영 시간표 고유 ID (자동 증가)
    movie_id NUMBER NOT NULL,                    -- 상영 영화 ID (외래키)
    cinema_id NUMBER NOT NULL,                  -- 상영관 ID (외래키)
    show_date DATE NOT NULL,                      -- 상영 날짜 (년-월-일)
    start_time DATE NOT NULL,                     -- 상영 시작 시각 (날짜+시간)
    end_time DATE,                                -- 상영 종료 시각 (날짜+시간)
    available_seats NUMBER,                       -- 남은 좌석 수
    price NUMBER NOT NULL,                        -- 티켓 가격
    status VARCHAR2(20) DEFAULT 'AVAILABLE',      -- 상영 상태 (예: AVAILABLE, SOLD_OUT, CANCELLED 등)
    CONSTRAINT fk_showtime_movie FOREIGN KEY (movie_id) REFERENCES MOVIE_MOVIES(movie_id),
    CONSTRAINT fk_showtime_cinema FOREIGN KEY (cinema_id) REFERENCES MOVIE_CINEMAS(cinema_id)
);

-- 예매 테이블 (결제 정보 통합)
CREATE TABLE MOVIE_RESERVATIONS (
    reservation_id NUMBER GENERATED ALWAYS AS IDENTITY(START WITH 1 INCREMENT BY 1 NOCACHE) PRIMARY KEY, -- 예매 고유 ID (자동 증가)
    user_id NUMBER,                              -- 예매한 사용자 ID (외래키)
    showtime_id NUMBER NOT NULL,                 -- 예매된 상영 시간표 ID (외래키)
    reservation_movie_poster_url CLOB,           -- 예매한 영화의 포스터 URL
    reservation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 예매한 시각
    total_amount NUMBER NOT NULL,                 -- 결제 총액
    reservation_status VARCHAR2(20) DEFAULT 'CONFIRMED',  -- 예매 상태 (예: CONFIRMED, CANCELLED)
    reservation_code VARCHAR2(20) UNIQUE,         -- 예매 코드 (고유)
    reserved_seats VARCHAR2(500),                  -- 예매된 좌석 번호 목록 (예: "A1,A2,B3")
    payment_method VARCHAR2(50),                   -- 결제 수단 (예: 신용카드, 체크카드, 계좌이체 등)
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 결제 완료 시각
    CONSTRAINT fk_reservation_user FOREIGN KEY (user_id) REFERENCES MOVIE_USERS(user_id),
    CONSTRAINT fk_reservation_showtime FOREIGN KEY (showtime_id) REFERENCES MOVIE_SHOWTIMES(showtime_id)
);

-- 조회용 SELECT 문들
SELECT * FROM MOVIE_USERS;
SELECT * FROM MOVIE_MOVIES;
SELECT * FROM MOVIE_CINEMAS;
SELECT * FROM MOVIE_SHOWTIMES;
SELECT * FROM MOVIE_RESERVATIONS;

--DROP TABLE MOVIE_USERS CASCADE CONSTRAINT;
--DROP TABLE MOVIE_MOVIES CASCADE CONSTRAINT;
--DROP TABLE MOVIE_CINEMAS CASCADE CONSTRAINT;
--DROP TABLE MOVIE_SHOWTIMES CASCADE CONSTRAINT;
--DROP TABLE MOVIE_RESERVATIONS CASCADE CONSTRAINT;

-- 영화 더미 데이터
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('기생충', 'https://image.tmdb.org/t/p/w500/7IiTTgloJzvGI1TAYymCfbfl3vT.jpg', '드라마', 132);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('벌새', 'https://image.tmdb.org/t/p/w500/kzUMfgRpH5TdtCBVS1KbzJ8G6Xl.jpg', '드라마', 138);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('극한직업', 'https://image.tmdb.org/t/p/w500/lPiI8I4ipM3IWK0JgGrfGtIBQsL.jpg', '코미디', 111);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('부산행', 'https://image.tmdb.org/t/p/w500/6R2LkfQPp6vuVhCJr8EiKkLVKDo.jpg', '액션', 118);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('아가씨', 'https://image.tmdb.org/t/p/w500/hq3NLFRr2nIf6Ah8U0NmGfCRhJf.jpg', '드라마', 145);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('올드보이', 'https://image.tmdb.org/t/p/w500/pWDtjs568ZfOTMbURQBYuT4Qj3a.jpg', '스릴러', 120);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('엑시트', 'https://image.tmdb.org/t/p/w500/5I9yWKIBj1e1ACrjKhfh4y2JsCD.jpg', '액션', 103);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('베테랑', 'https://image.tmdb.org/t/p/w500/Amk2zGFg8ZuUcKBjZHGm4gNdJld.jpg', '액션', 123);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('왕의 남자', 'https://image.tmdb.org/t/p/w500/8jBWQfEzONh3Ut9FqTJ7eQx73I0.jpg', '드라마', 119);
INSERT INTO MOVIE_MOVIES (title, poster_image_url, genre, duration) VALUES ('범죄와의 전쟁', 'https://image.tmdb.org/t/p/w500/7GeBnCLEY2lrhcEQZdkWOTpOglk.jpg', '범죄', 133);

-- 상영관 더미 데이터
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('1관', 180, '일반', 'A1-A15,B1-B15,C1-C15,D1-D15,E1-E15,F1-F15,G1-G15,H1-H15,I1-I15,J1-J15,K1-K15,L1-L15');
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('2관', 150, '일반', 'A1-A15,B1-B15,C1-C15,D1-D15,E1-E15,F1-F15,G1-G15,H1-H15,I1-I15,J1-J15');
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('3관', 120, 'VIP', 'A1-A12,B1-B12,C1-B12,D1-D12,E1-E12,F1-F12,G1-G12,H1-H12,I1-I12,J1-J12');
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('4관', 200, 'IMAX', 'A1-A20,B1-B20,C1-C20,D1-D20,E1-E20,F1-F20,G1-G20,H1-H20,I1-I20,J1-J20');
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('5관', 90, '4DX', 'A1-A9,B1-B9,C1-C9,D1-D9,E1-E9,F1-F9,G1-G9,H1-H9,I1-I9,J1-J9');
INSERT INTO MOVIE_CINEMAS (cinema_name, total_seats, cinema_type, seat_layout) VALUES ('6관', 160, '일반', 'A1-A16,B1-B16,C1-C16,D1-D16,E1-E16,F1-F16,G1-G16,H1-H16,I1-I16,J1-J16');

-- 상영 시간표 더미 데이터 (모두 2025년 7월 16일)
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (1, 1, DATE '2025-07-16', TO_DATE('2025-07-16 09:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 11:12', 'YYYY-MM-DD HH24:MI'), 180, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (1, 2, DATE '2025-07-16', TO_DATE('2025-07-16 13:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 15:42', 'YYYY-MM-DD HH24:MI'), 150, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (1, 3, DATE '2025-07-16', TO_DATE('2025-07-16 18:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 20:12', 'YYYY-MM-DD HH24:MI'), 120, 15000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (2, 1, DATE '2025-07-16', TO_DATE('2025-07-16 11:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 13:48', 'YYYY-MM-DD HH24:MI'), 180, 11000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (2, 4, DATE '2025-07-16', TO_DATE('2025-07-16 16:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 18:18', 'YYYY-MM-DD HH24:MI'), 200, 18000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (3, 2, DATE '2025-07-16', TO_DATE('2025-07-16 10:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 11:51', 'YYYY-MM-DD HH24:MI'), 150, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (3, 5, DATE '2025-07-16', TO_DATE('2025-07-16 14:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 16:21', 'YYYY-MM-DD HH24:MI'), 90, 25000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (3, 6, DATE '2025-07-16', TO_DATE('2025-07-16 19:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 21:21', 'YYYY-MM-DD HH24:MI'), 160, 13000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (4, 4, DATE '2025-07-16', TO_DATE('2025-07-16 10:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 12:28', 'YYYY-MM-DD HH24:MI'), 200, 18000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (4, 1, DATE '2025-07-16', TO_DATE('2025-07-16 15:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 16:58', 'YYYY-MM-DD HH24:MI'), 180, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (4, 6, DATE '2025-07-16', TO_DATE('2025-07-16 21:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 23:28', 'YYYY-MM-DD HH24:MI'), 160, 13000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (5, 3, DATE '2025-07-16', TO_DATE('2025-07-16 12:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 14:25', 'YYYY-MM-DD HH24:MI'), 120, 15000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (5, 2, DATE '2025-07-16', TO_DATE('2025-07-16 20:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 22:25', 'YYYY-MM-DD HH24:MI'), 150, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (6, 1, DATE '2025-07-16', TO_DATE('2025-07-16 21:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 23:00', 'YYYY-MM-DD HH24:MI'), 180, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (6, 3, DATE '2025-07-16', TO_DATE('2025-07-16 16:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 18:30', 'YYYY-MM-DD HH24:MI'), 120, 15000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (7, 5, DATE '2025-07-16', TO_DATE('2025-07-16 11:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 12:43', 'YYYY-MM-DD HH24:MI'), 90, 25000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (7, 6, DATE '2025-07-16', TO_DATE('2025-07-16 17:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 18:43', 'YYYY-MM-DD HH24:MI'), 160, 13000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (8, 4, DATE '2025-07-16', TO_DATE('2025-07-16 13:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 15:03', 'YYYY-MM-DD HH24:MI'), 200, 18000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (8, 2, DATE '2025-07-16', TO_DATE('2025-07-16 17:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 19:33', 'YYYY-MM-DD HH24:MI'), 150, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (9, 3, DATE '2025-07-16', TO_DATE('2025-07-16 14:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 15:59', 'YYYY-MM-DD HH24:MI'), 120, 15000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (9, 1, DATE '2025-07-16', TO_DATE('2025-07-16 19:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 20:59', 'YYYY-MM-DD HH24:MI'), 180, 12000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (10, 6, DATE '2025-07-16', TO_DATE('2025-07-16 15:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 17:43', 'YYYY-MM-DD HH24:MI'), 160, 13000, 'AVAILABLE');
INSERT INTO MOVIE_SHOWTIMES (movie_id, cinema_id, show_date, start_time, end_time, available_seats, price, status) VALUES (10, 4, DATE '2025-07-16', TO_DATE('2025-07-16 20:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2025-07-16 22:43', 'YYYY-MM-DD HH24:MI'), 200, 18000, 'AVAILABLE');

